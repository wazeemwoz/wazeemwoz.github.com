task :default => [:"deploy:upload_master"]

desc "deploy jekyll site"
namespace :deploy do   

  desc "run jekyll"
  task :build_site do
    puts "building production _site"
    system('jekyll --no-auto')
    puts "building _site complete"
  end
  
  desc "dev add"
  task :dev_add => :build_site do
    puts "adding changes to dev branch"
    system('git add -A')
    puts "git dev add complete"
  end
  
  desc "dev commit"
  task :dev_commit => :dev_add do
    message = ENV["DEV_MESSAGE"] || "commit not described"
    puts "commit changes to dev branch"
    system("git commit -m \"#{message}\"")
    puts "git dev commit complete"
  end
   
  desc "push dev"
  task :upload_dev => :dev_commit do
    puts "pushing dev to github"
    system('git push origin dev')
    puts "upload dev complete"
  end
  
  desc "temp site"
  task :temp_site => :upload_dev do
    temp = ENV["TEMP_DEST"] || "C:\\Sites\\temp"
    puts "clearing temp folder"
    system("DEL /Q #{temp}")
    puts "moving dev _site to temp folder"
    system("COPY _site #{temp}")
    puts "move complete"
  end
  
  desc "checkout master"
  task :branch_master => :temp_site do
    puts "checkout master"
    system('git checkout master')
  end
  
  desc "temp site"
  task :site_changed => :branch_master do
    message = ENV["DEV_MESSAGE"] || "commit not described"
    temp = ENV["TEMP_DEST"] || "C:\\Sites\\temp"
    puts "clearing site folder"
    system("DEL /Q *")
    puts "moving temp to master"
    system("COPY #{temp}")
    puts "move complete"
  end
  
  desc "master add"
  task :master_add => :site_changed do
    puts "adding changes to dev branch"
    system('git add -A')
    puts "git dev add complete"
  end
  
  desc "master commit"
  task :master_commit => :master_add do
    message = ENV["DEV_MESSAGE"] || "commit not described"
    puts "commit changes to master branch"
    system("git commit -am \"#{message}\"")
    puts "git master commit complete"
  end
  
  desc "push master"
  task :upload_master => :master_commit do
    puts "pushing master to github"
    system('git push -f origin master')
    puts "upload master complete"
  end
  
  desc "revert to jekyll"
  task :jekyll => :upload_master do
    puts "checking out dev"
    system('git checkout dev')
    puts "Rake task complete!"
  end
end
  